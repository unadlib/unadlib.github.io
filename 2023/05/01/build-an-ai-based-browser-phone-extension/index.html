


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <title>Build an AI-based browser phone extensionunadlib&#39;s Notes</title>
  <script>
    (function() {
      try {
        var themeKey = 'attraction-theme';
        var savedTheme = localStorage.getItem(themeKey);
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = savedTheme || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      } catch (e) {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
  <style type="text/css">
    body, html {
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
      font-size: 18px;
      line-height: 1.8;
      user-select: none;
      box-sizing: border-box;
      touch-action: manipulation;
    }

    a.title {
      text-decoration: none;
    }

    #content-outer {
      margin: 4% 14%;
      padding: 4% 8%;
      border-radius: 5px;
      box-sizing: border-box;
    }

    #content-inner {
      width: 100%;
      overflow: hidden;
    }

    .recent-post-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 16px;
    }

    .recent-post-item .title {
      overflow: hidden;
      text-overflow:ellipsis;
      white-space: nowrap;
    }

    .recent-post-item .time {
      font-size: 14px;
      line-height: 32px;
      min-width: 81px;
      text-align: right;
    }

    #post img {
      max-width: 100%;
    }

    #post h1.title {
      text-align: center;
      font-size: 2em;
      margin-block-start: 0.67em;
      margin-block-end: 0.67em;
      line-height: 1;
    }

    #post .time {
      text-align: center;
      font-size: 14px;
    }

    #post .content {
      margin-top: 8%;
    }

    #post .content blockquote {
      padding-left: 20px;
      margin: 0;
    }

    #post .content .gutter {
      display: none;
    }

    code, kbd, pre, samp {
      font-size: 16px !important;
    }

    .CodeMirror {
      height: auto !important;
      padding: 36px 24px 0;
      border-radius: 6px;
    }

    #post .content figure {
      padding: 0 1em;
      margin: 0;
      overflow: auto;
    }

    #post .content figure table {
      width: 100%;
    }

    @media screen and (max-width: 1024px)  {
      #content-outer {
        margin: 2% 7%;
        padding: 2% 4%;
      }

      .recent-post-item:first-child {
        margin-top: 16px;
      }
    }

    @media screen and (max-width: 480px) {
      body{
        -webkit-text-size-adjust: none;
      }

      #content-outer {
        margin: 0;
        padding: 2% 4%;
        border-radius: 0;
      }

      .recent-post-item:first-child {
        margin-top: 32px;
      }

      .recent-post-item:last-child {
        border-bottom: none;
      }
    }
  </style>
  
    <!-- styles list from theme config.yml -->
    
      <link rel="stylesheet" href="/css/theme.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/codemirror.min.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/theme/seti.min.css">
    
  
<meta name="generator" content="Hexo 8.1.1"></head>
<body class="cm-s-seti">

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <h1 class="title">Build an AI-based browser phone extension</h1>
  <p class="time">2023-05-01</span>
  <div class="content">
      <h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><p>On March 14, 2023, OpenAI released GPT-4, a transformer-based model that is more reliable, intelligent, and capable of handling nuanced instructions compared to GPT-3.5. GPT-4 has consistently outperformed other Large Language Models (LLMs) in various benchmarks, leading to a surge in diverse AI-powered applications built upon it. Among these applications, the “phone” remains a fundamental human communication need and a core communication service for businesses. The potential for AI to enhance communication efficiency and quality in phone interactions is significant and worth exploring.</p>
<p>Compared to traditional phone applications, we aim to build an AI-driven browser phone extension. This extension is envisioned to leverage AI to assist in every stage of the phone call process, ultimately improving the user’s calling experience.</p>
<ol>
<li>Before a call, we want it to help us extract contact information from any third-party webpage, especially complex ones. Crucially, it should provide intelligent analysis of relevant contact data (call recordings, voicemails, SMS, etc.) associated with each identified contact. This would enable us to understand sentiment analysis or potential draft summaries for upcoming calls, and more.</li>
<li>During a call, the spoken dialogue will be transcribed into text in real-time. Based on this live text conversation, the extension should offer effective intelligent prompts and assistance. It could even intelligently deploy an AI voicebot to participate in the conversation.</li>
<li>After a call concludes, it will intelligently generate a call sentiment assessment, conversation summary, and to-do list based on the current call information, the conversation transcript, and potentially past interactions with the contact. It will also provide automatic form filling in any CRM page forms.</li>
</ol>
<p>Once this browser phone extension delivers these functionalities, we will see a seamless integration of phone workflows with relevant platforms. This demonstrates the practical application of AI in optimizing the entire call workflow.</p>
<h2 id="Integrated-AI-Services-and-Capabilities"><a href="#Integrated-AI-Services-and-Capabilities" class="headerlink" title="Integrated AI Services and Capabilities"></a>Integrated AI Services and Capabilities</h2><p>Before implementing this extension, we should clearly define the AI services and capabilities we plan to integrate:</p>
<ul>
<li>OpenAI SDK: Provides the chat&#x2F;completions API for intelligent content generation.</li>
<li>OpenAI SDK: Provides the audio&#x2F;transcriptions API for transcribing audio files to text.</li>
<li>Azure: Additionally offers real-time STT (Speech-to-Text) and TTS (Text-to-Speech) APIs.</li>
</ul>
<h2 id="Flowchart"><a href="#Flowchart" class="headerlink" title="Flowchart"></a>Flowchart</h2><p>Based on the above three sets of APIs, combined with Browser Extension APIs, let’s design the overall business process:</p>
<p><img src="/assets/2023-05-01-build-an-ai-based-browser-phone-extension/flowchart.png" alt="BDD"></p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><h3 id="Creating-a-Basic-browser-phone-extension-Project"><a href="#Creating-a-Basic-browser-phone-extension-Project" class="headerlink" title="Creating a Basic browser phone extension Project"></a>Creating a Basic browser phone extension Project</h3><p>We can base our project on the open-source browser-extension-boilerplate, which supports building browser extensions for multiple browsers:</p>
<ul>
<li>Chrome</li>
<li>Firefox</li>
<li>Opera (Chrome Build)</li>
<li>Edge (Chrome Build)</li>
<li>Brave</li>
<li>Safari</li>
</ul>
<p>We will designate content.js as the JavaScript file that the extension will inject by default into any tabs. We will designate background.js as the browser’s service worker, which will be used to pop up a separate page (client.js) that can function as the Phone app.</p>
<p>Taking the manifest.json configuration of a Chrome MV3 extension as an example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;manifest_version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;demo&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.0.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A browser extension demo&quot;</span>,</span><br><span class="line">  <span class="string">&quot;background&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;service_worker&quot;</span>: <span class="string">&quot;background.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;action&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">&quot;icons&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;128&quot;</span>: <span class="string">&quot;logo.png&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;permissions&quot;</span>: [<span class="string">&quot;tabs&quot;</span>, <span class="string">&quot;activeTab&quot;</span>, <span class="string">&quot;debugger&quot;</span>, <span class="string">&quot;management&quot;</span>],</span><br><span class="line">  <span class="string">&quot;host_permissions&quot;</span>: [<span class="string">&quot;http://*/&quot;</span>, <span class="string">&quot;https://*/&quot;</span>],</span><br><span class="line">  <span class="string">&quot;content_scripts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;http://*/*&quot;</span>, <span class="string">&quot;https://*/*&quot;</span>, <span class="string">&quot;&lt;all_urls&gt;&quot;</span>],</span><br><span class="line">      <span class="string">&quot;js&quot;</span>: [<span class="string">&quot;content.js&quot;</span>],</span><br><span class="line">      <span class="string">&quot;css&quot;</span>: [<span class="string">&quot;content.styles.css&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;web_accessible_resources&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;resources&quot;</span>: [<span class="string">&quot;content.styles.css&quot;</span>, <span class="string">&quot;logo.png&quot;</span>],</span><br><span class="line">      <span class="string">&quot;matches&quot;</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;resources&quot;</span>: [<span class="string">&quot;client.html&quot;</span>, <span class="string">&quot;redirect.html&quot;</span>, <span class="string">&quot;logo.png&quot;</span>],</span><br><span class="line">      <span class="string">&quot;matches&quot;</span>: [<span class="string">&quot;&lt;all_urls&gt;&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We should primarily focus on the permissions section:</p>
<ul>
<li>tabs and activeTab are mainly used for tab communication and status capture, etc.</li>
<li>debugger will primarily be used for automating webpage operations.</li>
</ul>
<h3 id="Implementing-Contact-Information-Extraction-from-Any-Webpage"><a href="#Implementing-Contact-Information-Extraction-from-Any-Webpage" class="headerlink" title="Implementing Contact Information Extraction from Any Webpage"></a>Implementing Contact Information Extraction from Any Webpage</h3><p>In <code>content.js</code>, we will implement basic content extraction from webpages:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">message, sender, sendResponse</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> type = message.<span class="property">type</span>;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">&quot;get-webpage-text&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_">sendResponse</span>(<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerText</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>And in <code>client.js</code>, we will implement the corresponding request for webpage content:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getActiveTab</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = <span class="keyword">await</span> chrome.<span class="property">tabs</span>.<span class="title function_">getCurrent</span>();</span><br><span class="line">  <span class="keyword">const</span> [activeTab] = (<span class="keyword">await</span> chrome.<span class="property">tabs</span>.<span class="title function_">query</span>(&#123; <span class="attr">active</span>: <span class="literal">true</span> &#125;)).<span class="title function_">filter</span>(</span><br><span class="line">    <span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== id</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> activeTab;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPageText</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> activeTab = <span class="keyword">await</span> <span class="title function_">getActiveTab</span>();</span><br><span class="line">  <span class="keyword">if</span> (!activeTab) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;No active tab found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(activeTab.<span class="property">id</span>!, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;get-webpage-text&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We only used the simple API document.body.innerText. A more complete extraction should consider content visibility, iframe content, and many other factors. Due to space limitations, we won’t elaborate further here.</p>
<p>Next, we will submit the extracted content to the OpenAI API to extract contact information:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchContactsInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> text = <span class="keyword">await</span> <span class="title function_">getPageText</span>();</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">`The following is the text of a web page using &#x27;document.body.innerText&#x27;, please help me to extract the information about the contact \n&#x27;<span class="subst">$&#123;text&#125;</span>&#x27;, result should be Array JSON format and data format be like below</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        name: string;</span></span><br><span class="line"><span class="string">        title: string;</span></span><br><span class="line"><span class="string">        phone: string;</span></span><br><span class="line"><span class="string">        email: string[];</span></span><br><span class="line"><span class="string">      &#125;[]</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">      IMPORTANT: only respond to the Array JSON result.</span></span><br><span class="line"><span class="string">      `</span>;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">fetchGPT</span>(&#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s worth mentioning that here we used a TypeScript interface as the prompt to ensure OpenAI returns a stable JSON data structure.</p>
<p>fetchGPT can be implemented independently. You can install the OpenAI SDK (openai) and set up your own API server.</p>
<h3 id="Intelligent-Contact-Analysis-and-Sorting"><a href="#Intelligent-Contact-Analysis-and-Sorting" class="headerlink" title="Intelligent Contact Analysis and Sorting"></a>Intelligent Contact Analysis and Sorting</h3><p>Once we have obtained contact information, we can match it with contacts in the current phone system and also match the corresponding call recordings, voicemails, and SMS messages. SMS messages are typically text-based, so we can organize this information and submit it directly to OpenAI. However, call recordings and voicemails are audio files, so we will need to use the OpenAI audio&#x2F;transcriptions API.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">transcriptVoicemail</span>(<span class="params">files</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">allSettled</span>(</span><br><span class="line">    files.<span class="title function_">map</span>(<span class="title function_">async</span> (file) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> body = &#123;</span><br><span class="line">        <span class="attr">file</span>: file.<span class="property">file</span>,</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;whisper-1&quot;</span>,</span><br><span class="line">        <span class="attr">temperature</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">response_format</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> [name, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(body)) &#123;</span><br><span class="line">        formData.<span class="title function_">append</span>(name, value <span class="keyword">as</span> never);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">firstValueFrom</span>(</span><br><span class="line">        <span class="title function_">defer</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">          <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`<span class="subst">$&#123;baseUrl&#125;</span>/v1/audio/transcriptions`</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">              <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">              <span class="title class_">Authorization</span>: <span class="string">&quot;Bearer your-api-key&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: formData,</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;fetch API failed&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> <span class="attr">data</span>: &#123;</span><br><span class="line">            <span class="attr">text</span>: string;</span><br><span class="line">          &#125; = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> data;</span><br><span class="line">        &#125;).<span class="title function_">pipe</span>(<span class="title function_">retry</span>(<span class="number">3</span>))</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">text</span>: data.<span class="property">text</span>, <span class="attr">url</span>: file.<span class="property">url</span> &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> voiceMailTranscriptions = results.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, result, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (result.<span class="property">status</span> === <span class="string">&quot;fulfilled&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> id = voiceMails[i].<span class="property">id</span>!;</span><br><span class="line">      <span class="keyword">const</span> value = result.<span class="property">value</span>;</span><br><span class="line">      acc[id] = &#123;</span><br><span class="line">        ...voiceMails[i],</span><br><span class="line">        <span class="attr">transcription</span>: value.<span class="property">text</span>,</span><br><span class="line">        <span class="attr">playURL</span>: value.<span class="property">url</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> acc;</span><br><span class="line">  &#125;, &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> voiceMailTranscriptions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This way, we can obtain transcriptions of voicemails. Similarly, we can also get transcriptions of call recordings.</p>
<p>Next, we will submit this information to OpenAI to analyze emotion:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getEmotion</span>(<span class="params">callRecordings, voiceMails, sms</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">`</span></span><br><span class="line"><span class="string">  Please give me the user&#x27;s emotion based on Below Call recordings, Voicemails and SMS, the emotion score between 0 to 100, angry is 0, peaceful is 100.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Call recordings:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;callRecordings&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Voicemails:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;voiceMails&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  SMS:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;sms&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Your response result should be JSON format and the data type be like below:</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    score: number;</span></span><br><span class="line"><span class="string">    description: string;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  IMPORTANT: only give me the json result</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">fetchGPT</span>(&#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Once we obtain the emotion analysis for each contact, we can sort these analyses to let users know the potential emotions associated with customer communication for each contact. This could indicate the ease or difficulty of communication, allowing users to plan their call strategies and schedules accordingly.</p>
<h3 id="Real-time-STT"><a href="#Real-time-STT" class="headerlink" title="Real-time STT"></a>Real-time STT</h3><p>Azure provides real-time STT and TTS services. We will use the official SDK, <code>microsoft-cognitiveservices-speech-sdk</code>, to implement STT:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> sdk <span class="keyword">from</span> <span class="string">&quot;microsoft-cognitiveservices-speech-sdk&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">startSpeechRecognition</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> speechConfig = sdk.<span class="property">SpeechConfig</span>.<span class="title function_">fromSubscription</span>(</span><br><span class="line">    subscriptionKey,</span><br><span class="line">    region</span><br><span class="line">  );</span><br><span class="line">  speechConfig.<span class="property">speechRecognitionLanguage</span> = language;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> stream = <span class="title function_">getMediaStream</span>();</span><br><span class="line">  <span class="keyword">if</span> (!stream) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> audioConfig = sdk.<span class="property">AudioConfig</span>.<span class="title function_">fromStreamInput</span>(stream);</span><br><span class="line">  <span class="keyword">const</span> newRecognizer = <span class="keyword">new</span> sdk.<span class="title class_">SpeechRecognizer</span>(speechConfig, audioConfig);</span><br><span class="line"></span><br><span class="line">  newRecognizer.<span class="property">recognizing</span> = <span class="function">(<span class="params">s, e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Recognizing: <span class="subst">$&#123;e.result.text&#125;</span>`</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  newRecognizer.<span class="property">recognized</span> = <span class="function">(<span class="params">s, e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Recognized: <span class="subst">$&#123;e.result.text&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">result</span>.<span class="property">text</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="title function_">setTranscript</span>(e.<span class="property">result</span>.<span class="property">text</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  newRecognizer.<span class="property">canceled</span> = <span class="function">(<span class="params">s, e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">errorCode</span> === sdk.<span class="property">CancellationErrorCode</span>.<span class="property">ErrorAPIKey</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Invalid or incorrect subscription key&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Canceled: <span class="subst">$&#123;e.errorDetails&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setIsListening</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  newRecognizer.<span class="property">sessionStopped</span> = <span class="function">(<span class="params">s, e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Session stopped&quot;</span>);</span><br><span class="line">    newRecognizer.<span class="title function_">stopContinuousRecognitionAsync</span>();</span><br><span class="line">    <span class="title function_">setIsListening</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  newRecognizer.<span class="title function_">startContinuousRecognitionAsync</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Listening...&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Error: <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">      newRecognizer.<span class="title function_">stopContinuousRecognitionAsync</span>();</span><br><span class="line">      <span class="title function_">setIsListening</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setRecognizer</span>(newRecognizer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this way, using sdk.AudioConfig.fromStreamInput(stream) with our WebRTC stream allows us to achieve real-time STT. Furthermore, by calling this method separately for both the input and output streams of WebRTC, we can obtain real-time text content for both sides of the conversation.</p>
<p>It’s worth noting that <code>microsoft-cognitiveservices-speech-sdk</code> provides a remarkably comprehensive set of input and output stream configurations to accommodate a wide range of STT scenarios.</p>
<h3 id="Intelligent-Hints-During-Calls"><a href="#Intelligent-Hints-During-Calls" class="headerlink" title="Intelligent Hints During Calls"></a>Intelligent Hints During Calls</h3><p>In the Azure SDK, the recognized event represents an intermediate, paused result in the ongoing speech recognition. When this event is triggered, we can submit the in-progress conversation text to OpenAI to help provide potential information:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getHint</span>(<span class="params">conversation</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">`</span></span><br><span class="line"><span class="string">  You are a conversational intelligent assistant, please give possible hints based on the following conversation:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;conversation&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Your response result should be JSON format and the data type be like below:</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    hint: string;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  IMPORTANT: only give me the json result</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">fetchGPT</span>(&#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The hints we obtain will also be displayed in the conversation UI, shown to the user in real-time to provide this intelligent assistance. For example, if the conversation involves discussing discount calculations, the AI will provide the calculated results.</p>
<h3 id="Generating-Emotion-Summary-and-To-Do-List-After-the-Call"><a href="#Generating-Emotion-Summary-and-To-Do-List-After-the-Call" class="headerlink" title="Generating Emotion, Summary, and To-Do List After the Call"></a>Generating Emotion, Summary, and To-Do List After the Call</h3><p>We will generate reports such as emotion analysis and summaries by using the complete conversation text as part of the prompt for OpenAI:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getReport</span>(<span class="params">conversation</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">`</span></span><br><span class="line"><span class="string">  Please help me to &quot;summarize&quot;, &quot;improvements&quot;, and &quot;evaluate&quot; the quality of the customer service from the following conversation,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;conversation&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  result should be JSON format,</span></span><br><span class="line"><span class="string">  summary and improvement please be more detailed, and format be like below</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  interface Report &#123;</span></span><br><span class="line"><span class="string">    summary: string;</span></span><br><span class="line"><span class="string">    improvements: string[];</span></span><br><span class="line"><span class="string">    evaluation: Evaluation;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  interface Evaluation &#123;</span></span><br><span class="line"><span class="string">    sellResult: &#x27;Deal&#x27; | &#x27;Lost deal&#x27; | &#x27;Follow up&#x27;;</span></span><br><span class="line"><span class="string">    customerEmotion: &#x27;Happy&#x27; | &#x27;Sad&#x27; | &#x27;Unhappy&#x27;;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  IMPORTANT: only give me the json result</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">fetchGPT</span>(&#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In a similar manner, we will also generate a to-do list for the current conversation:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getTodoList</span>(<span class="params">conversation</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">`</span></span><br><span class="line"><span class="string">  I am a sales agent. Please Help me generate a todo list in customer relationship management platform for the following conversation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;conversations&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  result should be Array JSON format, and checked, processing to be false</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type ToDoListItem = &#123;</span></span><br><span class="line"><span class="string">    id: string;</span></span><br><span class="line"><span class="string">    checked: boolean;</span></span><br><span class="line"><span class="string">    message: string;</span></span><br><span class="line"><span class="string">    processing: boolean;</span></span><br><span class="line"><span class="string">  &#125;[];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  IMPORTANT: only give me the Array JSON result, make sure that only the above conversation is relevant.</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">fetchGPT</span>(&#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Intelligently-Filling-Out-Forms"><a href="#Intelligently-Filling-Out-Forms" class="headerlink" title="Intelligently Filling Out Forms"></a>Intelligently Filling Out Forms</h3><p>As a fundamental communication service for businesses, phone systems are commonly integrated with third-party CRM platforms. Therefore, intelligently auto-filling CRM forms can efficiently assist collaboration for ToB (business-to-business) users.</p>
<p>To implement intelligent form filling, the first step is to address how to extract and compress DOM information from form pages of any third-party CRM. Here, we reference TaxyAI’s DOM compression model:</p>
<p>By traversing all nodes in the DOM and analyzing their validity, we retain valid attribute information and assign a DI (presumably “DOM Identifier”) tag to each valid node.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allowedAttributes = [</span><br><span class="line">  <span class="string">&quot;aria-label&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data-name&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>,</span><br><span class="line">  <span class="string">&quot;placeholder&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>,</span><br><span class="line">  <span class="string">&quot;role&quot;</span>,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sample = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">  &lt;button</span></span><br><span class="line"><span class="string">    aria-label=&quot;Add to wishlist: Brinnon, Washington&quot;</span></span><br><span class="line"><span class="string">    type=&quot;button&quot;</span></span><br><span class="line"><span class="string">    id=&quot;1396&quot;</span></span><br><span class="line"><span class="string">  &gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">  &lt;div aria-label=&quot;Photo 1 of 6&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>Once we have the compressed DOM information, we can also obtain the webpage labels by analyzing it (through analyzing attributes such as visibility, effective width and height, and operability). Then, we submit this to OpenAI:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getFieldValues</span>(<span class="params"></span></span><br><span class="line"><span class="params">  labels,</span></span><br><span class="line"><span class="params">  domainInfo,</span></span><br><span class="line"><span class="params">  callInfo,</span></span><br><span class="line"><span class="params">  conversation,</span></span><br><span class="line"><span class="params">  summary</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">`</span></span><br><span class="line"><span class="string">  You are a browser DOM automation assistant. Your goal is to help me fill in the customer relationship management Task form based on the conversation I provided.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  In the summary field, input the summary of the conversation, and the call transcription.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This is an example of the field</span></span><br><span class="line"><span class="string">  &#123; key: &#x27;Title&#x27; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This is an example of the response</span></span><br><span class="line"><span class="string">  &#123; key: &#x27;Title&#x27;, value: &#x27;Here is the value for title&#x27; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  You must always keep result should be JSON format and data format be like below:</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    key: string;</span></span><br><span class="line"><span class="string">    value: string;</span></span><br><span class="line"><span class="string">  &#125;[]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  the list of input fields:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(labels, <span class="literal">null</span>, <span class="number">2</span>)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Domain information:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;domainInfo&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Call information:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;callInfo&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Conversation:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;conversation&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Summary:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;summary&#125;</span></span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">fetchGPT</span>(&#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Once we have fieldValues, we submit the current page and fieldValues to OpenAI, so that it can generate the values for the corresponding input fields:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getInputValues</span>(<span class="params">fieldValues, dom</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="string">`</span></span><br><span class="line"><span class="string">  You are a browser automation assistant.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  You will be given a webpage DOM data and a list of input data. You should tell me how I can fill in the field based on the information.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This is an example of the DOM:</span></span><br><span class="line"><span class="string">  &lt;div id=&quot;1101&quot;&gt;Title&lt;input id=&quot;1102&quot;&gt;&lt;div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This is an example of the input data:</span></span><br><span class="line"><span class="string">  &#123; key: &#x27;Title&#x27;, value: &#x27;Here is the value for title&#x27; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This is an example of the response:</span></span><br><span class="line"><span class="string">  &#123; id: &#x27;1102&#x27;, value: &#x27;Here is the value for title&#x27; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Here is the list of input data:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;fieldValues&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Here is the webpage DOM:</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;dom&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Your response result should be JSON format and the data type be like below:</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    id: string;</span></span><br><span class="line"><span class="string">    value: string;</span></span><br><span class="line"><span class="string">  &#125;[]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  IMPORTANT: only give me the json result</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">fetchGPT</span>(&#123;</span><br><span class="line">    content,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, we send these values to the current CRM form page to complete the automatic form filling.</p>
<p>In <code>client.js</code>, we send inputValues:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendInputValues</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> chrome.<span class="property">tabs</span>.<span class="title function_">sendMessage</span>(activeTab.<span class="property">id</span>!, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;auto-run-action&#x27;</span>,</span><br><span class="line">    <span class="attr">action</span>: inputValues.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">value</span>),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In <code>content.js</code>, complete the final input filling:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">message, sender, sendResponse</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; type, action &#125; = message;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">&quot;auto-run-action&quot;</span>) &#123;</span><br><span class="line">    action.<span class="title function_">forEach</span>(<span class="function">(<span class="params">&#123; id, value &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> inputElement = <span class="title function_">getElementById</span>(id);</span><br><span class="line">      <span class="keyword">if</span> (!inputElement) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Could not find element with id&quot;</span>, id);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      inputElement.<span class="property">value</span> = value;</span><br><span class="line">      inputElement.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&quot;change&quot;</span>, &#123; <span class="attr">bubbles</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">sendResponse</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>We omit the details of handling more complex form types.</p>
<h3 id="Browser-Automated-To-Do-Execution"><a href="#Browser-Automated-To-Do-Execution" class="headerlink" title="Browser Automated To-Do Execution"></a>Browser Automated To-Do Execution</h3><p>We leverage the TaxyAI automated execution DOM operation model mentioned earlier, which utilizes OpenAI to control the browser and perform repetitive actions on behalf of the user.</p>
<p>By appending Thought and Action contextual prompts, OpenAI will iteratively and logically deduce the next DOM operation until the current to-do item is fulfilled.</p>
<p>This is the crucial function for formatting the prompt:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">formatPrompt</span>(<span class="params">taskInstructions, previousActions, pageContents</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> previousActionsString = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (previousActions.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> serializedActions = previousActions</span><br><span class="line">      .<span class="title function_">map</span>(</span><br><span class="line">        <span class="function">(<span class="params">action</span>) =&gt;</span></span><br><span class="line">          <span class="string">`&lt;Thought&gt;<span class="subst">$&#123;action.thought&#125;</span>&lt;/Thought&gt;\n&lt;Action&gt;<span class="subst">$&#123;action.action&#125;</span>&lt;/Action&gt;`</span></span><br><span class="line">      )</span><br><span class="line">      .<span class="title function_">join</span>(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">    previousActionsString = <span class="string">`You have already taken the following actions: \n<span class="subst">$&#123;serializedActions&#125;</span>\n\n`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`The user requests the following task:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">$&#123;taskInstructions&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">$&#123;previousActionsString&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Current time: <span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString()&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Current page contents:</span></span><br><span class="line"><span class="string"><span class="subst">$&#123;pageContents&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>At this point, we have essentially implemented an AI-based browser phone extension that covers the entire phone call workflow.</p>
<p>This article serves as a Proof of Concept (PoC) and aims to outline the general implementation of the relevant processes. However, the application still has many details requiring improvement in areas such as cost, privacy and security, and performance. For instance, cost control might be achieved through techniques like pre-calculating tokens for segmented requests, and privacy concerns could be addressed by employing local Web LLM-based de-sensitization processing, and so on.</p>

  </div>
</article>

  </div>
</div>


  <!-- scripts list from theme config.yml -->
  
    <script src="/js/attraction.js"></script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/codemirror.min.js"></script>
  
  <script>
    var nodes = Array.from(document.querySelectorAll('pre code'));
    var render = {};
    var titleSvg = '<svg style="position: absolute;z-index: 1;margin: 12px 0 0 12px;" xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg>';
    nodes.forEach((node, index) => {
      var lang = node.getAttribute('class');
      var code = node.innerText;
      var mode = lang;
      switch(lang) {
        case 'jsx':
          lang = 'javascript';
          mode = 'text/jsx';
          break;
        case 'tsx':
          lang = 'javascript';
          mode = 'text/typescript-jsx';
        case 'typescript':
          lang = 'javascript';
          mode = 'text/typescript';
        default:
          break;
      }
      var config = {
        value: code,
        mode,
        theme: 'seti'
      };
      if (!lang) return;
      var hasExisted = nodes.slice(0, index).find(function(node) { return node.getAttribute('class') === lang; });
      if (hasExisted) {
        render[lang].push(function() {
          node.innerHTML = titleSvg;
          CodeMirror(node, config);
        });
        return;
      }
      render[lang] = [];
      var languagePackge = document.createElement('script');
      languagePackge.src = `https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/mode/${lang}/${lang}.min.js`;
      languagePackge.onload = () => {
        setTimeout(() => {
          node.innerHTML = titleSvg;
          CodeMirror(node, config);
          render[lang].forEach(function(callback) { callback(); })
        }, 0);
      }
      document.body.appendChild(languagePackge);
    });
  </script>

</body>
</html>
