


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <title>Rethinking undo/redo - why we need Travelsunadlib&#39;s Notes</title>
  <script>
    (function() {
      try {
        var themeKey = 'attraction-theme';
        var savedTheme = localStorage.getItem(themeKey);
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = savedTheme || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      } catch (e) {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
  <style type="text/css">
    body, html {
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
      font-size: 18px;
      line-height: 1.8;
      user-select: none;
      box-sizing: border-box;
      touch-action: manipulation;
    }

    a.title {
      text-decoration: none;
    }

    #content-outer {
      margin: 4% 14%;
      padding: 4% 8%;
      border-radius: 5px;
      box-sizing: border-box;
    }

    #content-inner {
      width: 100%;
      overflow: hidden;
    }

    .recent-post-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 16px;
    }

    .recent-post-item .title {
      overflow: hidden;
      text-overflow:ellipsis;
      white-space: nowrap;
    }

    .recent-post-item .time {
      font-size: 14px;
      line-height: 32px;
      min-width: 81px;
      text-align: right;
    }

    #post img {
      max-width: 100%;
    }

    #post h1.title {
      text-align: center;
      font-size: 2em;
      margin-block-start: 0.67em;
      margin-block-end: 0.67em;
      line-height: 1;
    }

    #post .time {
      text-align: center;
      font-size: 14px;
    }

    #post .content {
      margin-top: 8%;
    }

    #post .content blockquote {
      padding-left: 20px;
      margin: 0;
    }

    #post .content .gutter {
      display: none;
    }

    code, kbd, pre, samp {
      font-size: 16px !important;
    }

    .CodeMirror {
      height: auto !important;
      padding: 36px 24px 0;
      border-radius: 6px;
    }

    #post .content figure {
      padding: 0 1em;
      margin: 0;
      overflow: auto;
    }

    #post .content figure table {
      width: 100%;
    }

    @media screen and (max-width: 1024px)  {
      #content-outer {
        margin: 2% 7%;
        padding: 2% 4%;
      }

      .recent-post-item:first-child {
        margin-top: 16px;
      }
    }

    @media screen and (max-width: 480px) {
      body{
        -webkit-text-size-adjust: none;
      }

      #content-outer {
        margin: 0;
        padding: 2% 4%;
        border-radius: 0;
      }

      .recent-post-item:first-child {
        margin-top: 32px;
      }

      .recent-post-item:last-child {
        border-bottom: none;
      }
    }
  </style>
  
    <!-- styles list from theme config.yml -->
    
      <link rel="stylesheet" href="/css/theme.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/codemirror.min.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/theme/seti.min.css">
    
  
<meta name="generator" content="Hexo 8.1.1"></head>
<body class="cm-s-seti">

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <h1 class="title">Rethinking undo/redo - why we need Travels</h1>
  <p class="time">2025-10-05</span>
  <div class="content">
      <blockquote>
<p>TL;DR: If your app state is large (&gt;10KB), needs persistence, or you care about memory usage and performance with long histories, Travels’ JSON Patch approach is worth considering. For simple scenarios, the default snapshot modes in Redux-undo or Zundo are actually simpler and more efficient.</p>
</blockquote>
<h2 id="Where-the-Problem-Starts"><a href="#Where-the-Problem-Starts" class="headerlink" title="Where the Problem Starts"></a>Where the Problem Starts</h2><p>Implementing usable undo&#x2F;redo sounds easy: store a full snapshot for every state change and restore it on undo. The problem is that when the state object is large and changes are small (the usual case), snapshot memory &#x3D; object size × history length. That linear growth is unacceptable for big objects. Worse, repeatedly deep-copying&#x2F;patch-diffing complex structures pushes the main thread toward jank—this isn’t something you “optimize a bit” to fix; it’s a category error.</p>
<p>Travels starts by making JSON Patch (RFC 6902) a first-class citizen: generate patches&#x2F;inversePatches incrementally as changes happen, trading compute for storage and serialization efficiency—preserving full reversibility while drastically shrinking history size.</p>
<p>Travels was created to resolve a fundamental tension: how to retain a complete history while minimizing memory and performance overhead.</p>
<h2 id="How-Mainstream-Approaches-Work"><a href="#How-Mainstream-Approaches-Work" class="headerlink" title="How Mainstream Approaches Work"></a>How Mainstream Approaches Work</h2><p>Let’s first look at how two popular community solutions work in practice.</p>
<h3 id="Redux-undo-Reference-Based-Snapshot-Storage"><a href="#Redux-undo-Reference-Based-Snapshot-Storage" class="headerlink" title="Redux-undo: Reference-Based Snapshot Storage"></a>Redux-undo: Reference-Based Snapshot Storage</h3><p>Redux-undo is the classic solution in the Redux ecosystem. Its core logic looks like:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// redux-undo/src/reducer.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">insert</span>(<span class="params">history, state, limit, group</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> newPast = [...pastSliced, _latestUnfiltered];</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">newHistory</span>(newPast, state, [], group);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Its strategy: <strong>store references to each state object</strong>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">past</span>: [state1, state2, state3],    <span class="comment">// array of object references</span></span><br><span class="line">  <span class="attr">present</span>: state4,</span><br><span class="line">  <span class="attr">future</span>: [state5, state6]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There’s no deep copy here; it relies on Redux’s immutable update pattern:</p>
<ul>
<li>Reducers return new objects each time</li>
<li>Structural sharing reduces memory copying</li>
<li><code>past</code> only holds references</li>
</ul>
<p><strong>Pros:</strong></p>
<ul>
<li>Simple, straightforward implementation</li>
<li>Efficient enough for small state</li>
<li>Supports fine-grained controls like <code>filter</code> and <code>groupBy</code></li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li>With Redux-undo plus Immer or immutable updates, unmodified subtrees share references. But each change still creates new objects for the changed node and all of its ancestors. For deep structures, even a single-field change can rebuild an entire parent chain.</li>
<li>Each history entry is effectively a full state snapshot</li>
<li>Tightly coupled to Redux; not usable elsewhere</li>
</ul>
<p>For a simple counter, this is perfectly fine. But for a complex document object, 100 history entries imply 100 state references <strong>plus</strong> each one’s memory footprint.</p>
<h3 id="Zundo-Optional-Diff-Optimization"><a href="#Zundo-Optional-Diff-Optimization" class="headerlink" title="Zundo: Optional Diff Optimization"></a>Zundo: Optional Diff Optimization</h3><p>Zundo is a tiny (&lt;700B) and flexible undo&#x2F;redo middleware for Zustand.</p>
<p>Core code:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// zundo/src/temporal.ts</span></span><br><span class="line"><span class="attr">_handleSet</span>: <span class="function">(<span class="params">pastState, replace, currentState, deltaState</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">set</span>(&#123;</span><br><span class="line">    <span class="attr">pastStates</span>: <span class="title function_">get</span>().<span class="property">pastStates</span>.<span class="title function_">concat</span>(deltaState || pastState),</span><br><span class="line">    <span class="attr">futureStates</span>: [],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Note <code>deltaState || pastState</code>:</p>
<ul>
<li><strong>Default stores the full state</strong> (<code>pastState</code>)</li>
<li><strong>Optionally stores a diff</strong> (<code>deltaState</code>, computed via user-provided <code>diff</code>)</li>
</ul>
<p>Although Zundo exposes a diff option, you must pick and configure a diff library and translate results yourself. For many developers, that adds learning cost. More importantly, diffing a large state tree frequently can itself become a performance bottleneck.</p>
<p>It’s a clever design:</p>
<ul>
<li><strong>Zero-cost abstraction</strong>: don’t opt in to diffs, pay no cost</li>
<li><strong>Flexibility</strong>: choose any diff algorithm (microdiff, fast-json-patch, etc.) or roll your own</li>
<li><strong>Control</strong>: pair with <code>partialize</code> to track only part of the state</li>
</ul>
<p><strong>Pros:</strong></p>
<ul>
<li>Supports diff-based storage; can optimize memory</li>
<li>Elegant API</li>
<li>Deep integration with Zustand</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li><strong>You must implement the diff logic yourself</strong>—not trivial</li>
<li>Zustand-only</li>
<li>Default behavior still stores full snapshots</li>
</ul>
<p>The catch: building a reliable diff is non-trivial. You must:</p>
<ol>
<li>Pick the right diff library</li>
<li>Write transformation code (like the example)</li>
<li>Handle edge cases (null, undefined, cycles, etc.)</li>
<li>Ensure reversibility (correct undo&#x2F;redo)</li>
</ol>
<p>And for very large trees, the diff stage itself can be expensive.</p>
<h2 id="Travels-JSON-Patch-as-a-First-Class-Citizen"><a href="#Travels-JSON-Patch-as-a-First-Class-Citizen" class="headerlink" title="Travels: JSON Patch as a First-Class Citizen"></a>Travels: JSON Patch as a First-Class Citizen</h2><p>This is where Travels comes in. Its core idea: <strong>use JSON Patch as the built-in, default storage format</strong>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createTravels &#125; <span class="keyword">from</span> <span class="string">&#x27;travels&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> travels = <span class="title function_">createTravels</span>(&#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;My Doc&#x27;</span>,</span><br><span class="line">  <span class="attr">content</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">  <span class="comment">// ... potentially a very large object</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">travels.<span class="title function_">setState</span>(<span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="property">title</span> = <span class="string">&#x27;New Title&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Internally, Travels stores:</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   patches: [&#123; op: &quot;replace&quot;, path: [&quot;title&quot;], value: &quot;New Title&quot; &#125;],</span></span><br><span class="line"><span class="comment">//   inversePatches: [&#123; op: &quot;replace&quot;, path: [&quot;title&quot;], value: &quot;My Doc&quot; &#125;]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// You can set &#123; patchesOptions: &#123; pathAsArray: true &#125; &#125; to make `path` a JSON path string.</span></span><br></pre></td></tr></table></figure>

<p>No configuration required—JSON Patch is default.</p>
<h3 id="Why-Mutative"><a href="#Why-Mutative" class="headerlink" title="Why Mutative?"></a>Why Mutative?</h3><p>Travels is built on <a href="https://github.com/unadlib/mutative">Mutative</a>. That choice matters:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mutative core capability</span></span><br><span class="line"><span class="keyword">import</span> &#123; create &#125; <span class="keyword">from</span> <span class="string">&#x27;mutative&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [nextState, patches, inversePatches] = <span class="title function_">create</span>(</span><br><span class="line">  &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="property">count</span>++;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">enablePatches</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// patches: [&#123; op: &quot;replace&quot;, path: [&quot;count&quot;], value: 1 &#125;]</span></span><br><span class="line"><span class="comment">// inversePatches: [&#123; op: &quot;replace&quot;, path: [&quot;count&quot;], value: 0 &#125;]</span></span><br></pre></td></tr></table></figure>

<p>Mutative provides:</p>
<ol>
<li><strong>Draft API</strong> – identical ergonomics to Immer</li>
<li><strong>Native JSON Patch generation</strong> – no extra diff library</li>
<li><strong>High performance</strong> – official benchmarks show up to 10× over Immer</li>
<li><strong>Zero configuration</strong> – patch generation is built-in, not optional</li>
</ol>
<p>This lets Travels leverage Mutative’s strengths directly, without forcing users to implement diffs like Zundo.</p>
<h3 id="Real-Memory-Differences"><a href="#Real-Memory-Differences" class="headerlink" title="Real Memory Differences"></a>Real Memory Differences</h3><p>A test with a 100KB complex object and 100 tiny edits (2 fields per edit):</p>
<p><strong>Redux-undo:</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stores full-state references</span></span><br><span class="line"><span class="attr">pastStates</span>: [</span><br><span class="line">  &#123; <span class="comment">/* 100KB object */</span> &#125;,</span><br><span class="line">  &#123; <span class="comment">/* 100KB object */</span> &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// 100 history entries: ~11.8 MB growth</span></span><br></pre></td></tr></table></figure>

<p><strong>Zundo (no diff):</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Default stores full state</span></span><br><span class="line"><span class="attr">pastStates</span>: [</span><br><span class="line">  &#123; <span class="comment">/* 100KB object */</span> &#125;,</span><br><span class="line">  &#123; <span class="comment">/* 100KB object */</span> &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// 100 history entries: ~11.8 MB growth</span></span><br></pre></td></tr></table></figure>

<p><strong>Travels:</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Automatically stores JSON Patches</span></span><br><span class="line"><span class="attr">patches</span>: [</span><br><span class="line">  [&#123; <span class="attr">op</span>: <span class="string">&#x27;replace&#x27;</span>, <span class="attr">path</span>: [<span class="string">&#x27;field1&#x27;</span>], <span class="attr">value</span>: <span class="string">&#x27;new&#x27;</span> &#125;],   <span class="comment">// ~50 bytes</span></span><br><span class="line">  [&#123; <span class="attr">op</span>: <span class="string">&#x27;replace&#x27;</span>, <span class="attr">path</span>: [<span class="string">&#x27;field2&#x27;</span>], <span class="attr">value</span>: <span class="string">&#x27;newer&#x27;</span> &#125;], <span class="comment">// ~50 bytes</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">];</span><br><span class="line"><span class="comment">// 100 histories: ~0.32 MB growth (≈97.3% saved)</span></span><br><span class="line"><span class="comment">// After serialization only ~20.6 KB (≈99.8% smaller than snapshots)</span></span><br></pre></td></tr></table></figure>

<p>The gap is stark. For large objects with small edits, Travels can deliver ~40× memory savings, and <strong>500×+</strong> on serialized size.</p>
<h3 id="Framework-Agnostic-by-Design"><a href="#Framework-Agnostic-by-Design" class="headerlink" title="Framework-Agnostic by Design"></a>Framework-Agnostic by Design</h3><p>Another advantage: Travels is framework-agnostic. The core is a plain state manager:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSyncExternalStore &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useTravel</span>(<span class="params">travels</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> state = <span class="title function_">useSyncExternalStore</span>(</span><br><span class="line">    travels.<span class="property">subscribe</span>.<span class="title function_">bind</span>(travels),</span><br><span class="line">    travels.<span class="property">getState</span>.<span class="title function_">bind</span>(travels),</span><br><span class="line">    travels.<span class="property">getState</span>.<span class="title function_">bind</span>(travels) <span class="comment">// for SSR</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> [state, travels.<span class="property">setState</span>.<span class="title function_">bind</span>(travels), travels.<span class="title function_">getControls</span>()];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useTravel</span>(<span class="params">travels</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> state = <span class="title function_">ref</span>(travels.<span class="title function_">getState</span>());</span><br><span class="line">  travels.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">newState</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">value</span> = newState;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123; state, travels &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Plain JS</span></span><br><span class="line">travels.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>).<span class="property">innerHTML</span> = <span class="title function_">render</span>(state);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Use it anywhere: React, Vue, Svelte, Angular, or vanilla JS.</p>
<h2 id="Side-by-Side-Comparison"><a href="#Side-by-Side-Comparison" class="headerlink" title="Side-by-Side Comparison"></a>Side-by-Side Comparison</h2><table>
<thead>
<tr>
<th>Dimension</th>
<th>Redux-undo</th>
<th>Zundo</th>
<th>Travels</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Storage model</strong></td>
<td>Snapshot references</td>
<td>Snapshot by default, diff</td>
<td>Built-in JSON Patch</td>
</tr>
<tr>
<td><strong>Config complexity</strong></td>
<td>Low</td>
<td>Medium (you write the diff)</td>
<td>Low</td>
</tr>
<tr>
<td><strong>Memory efficiency</strong></td>
<td>Medium (sharing helps)</td>
<td>Low→High (depends on diff)</td>
<td>High (out of the box)</td>
</tr>
<tr>
<td><strong>Persistence fit</strong></td>
<td>Poor (large data)</td>
<td>Poor (large data)</td>
<td>Excellent (compact + standard)</td>
</tr>
<tr>
<td><strong>Frameworks</strong></td>
<td>Redux only</td>
<td>Zustand only</td>
<td>Framework-agnostic</td>
</tr>
<tr>
<td><strong>Highlights</strong></td>
<td>filter, groupBy</td>
<td>partialize, custom diff</td>
<td>Auto&#x2F;manual archive, mutable mode</td>
</tr>
<tr>
<td><strong>Core LOC (approx.)</strong></td>
<td>~440</td>
<td>~250</td>
<td>~640</td>
</tr>
</tbody></table>
<h2 id="A-Few-Neat-Designs-in-Travels"><a href="#A-Few-Neat-Designs-in-Travels" class="headerlink" title="A Few Neat Designs in Travels"></a>A Few Neat Designs in Travels</h2><h3 id="1-Auto-Manual-Archive-Modes"><a href="#1-Auto-Manual-Archive-Modes" class="headerlink" title="1) Auto&#x2F;Manual Archive Modes"></a>1) Auto&#x2F;Manual Archive Modes</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Auto: each setState becomes a history entry</span></span><br><span class="line"><span class="keyword">const</span> travels = <span class="title function_">createTravels</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line">travels.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;); <span class="comment">// +1 history</span></span><br><span class="line">travels.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: <span class="number">2</span> &#125;); <span class="comment">// +1 history</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Manual: batch multiple changes into one entry</span></span><br><span class="line"><span class="keyword">const</span> travels = <span class="title function_">createTravels</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;, &#123; <span class="attr">autoArchive</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">travels.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;);</span><br><span class="line">travels.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: <span class="number">2</span> &#125;);</span><br><span class="line">travels.<span class="title function_">setState</span>(&#123; <span class="attr">count</span>: <span class="number">3</span> &#125;);</span><br><span class="line">travels.<span class="title function_">archive</span>(); <span class="comment">// record only 0→3 as one history entry</span></span><br></pre></td></tr></table></figure>

<p>Manual mode is ideal for complex interactions. E.g., a drag operation might trigger dozens of updates, but you want it to undo as one unit.</p>
<h3 id="2-Mutable-Mode-for-Reactive-Frameworks"><a href="#2-Mutable-Mode-for-Reactive-Frameworks" class="headerlink" title="2) Mutable Mode for Reactive Frameworks"></a>2) Mutable Mode for Reactive Frameworks</h3><p>In Vue&#x2F;MobX (Proxy-based reactivity), replacing object references breaks reactivity. Travels offers <code>mutable</code> mode:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue example</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> travels = <span class="title function_">createTravels</span>(<span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;), &#123; <span class="attr">mutable</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Travels mutates in place, keeping the Proxy reference</span></span><br><span class="line">travels.<span class="title function_">setState</span>(<span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="property">count</span>++;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Vue reactivity stays intact</span></span><br></pre></td></tr></table></figure>

<p>Implementation sketch:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">mutable</span>) &#123;</span><br><span class="line">  <span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">state</span> <span class="keyword">as</span> <span class="built_in">object</span>, patches, &#123; <span class="attr">mutable</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pendingState</span> = <span class="variable language_">this</span>.<span class="property">state</span>; <span class="comment">// keep the reference stable</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">state</span> = <span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">state</span> <span class="keyword">as</span> <span class="built_in">object</span>, patches) <span class="keyword">as</span> S;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This allows seamless use in reactive frameworks.</p>
<h3 id="3-Sliding-Window-via-maxHistory"><a href="#3-Sliding-Window-via-maxHistory" class="headerlink" title="3) Sliding Window via maxHistory"></a>3) Sliding Window via <code>maxHistory</code></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> travels = <span class="title function_">createTravels</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;, &#123; <span class="attr">maxHistory</span>: <span class="number">3</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5 consecutive ops</span></span><br><span class="line"><span class="title function_">increment</span>(); <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">increment</span>(); <span class="comment">// 2</span></span><br><span class="line"><span class="title function_">increment</span>(); <span class="comment">// 3</span></span><br><span class="line"><span class="title function_">increment</span>(); <span class="comment">// 4</span></span><br><span class="line"><span class="title function_">increment</span>(); <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// History window: [2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">// You can undo back to 2, but not to 0 or 1 due to the window size</span></span><br><span class="line"><span class="comment">// however, reset() can return to the initial state 0.</span></span><br></pre></td></tr></table></figure>

<p>Great for memory-constrained environments.</p>
<h2 id="Hands-On-Experience"><a href="#Hands-On-Experience" class="headerlink" title="Hands-On Experience"></a>Hands-On Experience</h2><p>I refactored a collaborative editor with Travels. Based on benchmark projections for a 100KB doc over 100 edits:</p>
<ul>
<li><strong>Memory</strong>: ~11.8MB (snapshots) → ~0.32MB (<strong>−97%</strong>)</li>
<li><strong>Persistence size</strong>: ~11.7MB → ~116KB (<strong>−99%</strong>)</li>
<li><strong>Serialization speed</strong>: ~12ms → ~0.06ms (<strong>≈200× faster</strong>)</li>
<li><strong>Code volume</strong>: ~40% less (no custom diff code)</li>
<li><strong>Undo&#x2F;redo</strong>: still sub-millisecond (≈0.69ms undo &#x2F; 0.27ms redo in the real-library test)</li>
</ul>
<p>And the API is intuitive:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> travels = <span class="title function_">createTravels</span>(initialState);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line">travels.<span class="title function_">setState</span>(<span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="property">title</span> = <span class="string">&#x27;New&#x27;</span>;</span><br><span class="line">  draft.<span class="property">sections</span>[<span class="number">0</span>].<span class="property">content</span> = <span class="string">&#x27;Updated&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Time travel</span></span><br><span class="line">travels.<span class="title function_">back</span>();     <span class="comment">// undo</span></span><br><span class="line">travels.<span class="title function_">forward</span>();  <span class="comment">// redo</span></span><br><span class="line">travels.<span class="title function_">go</span>(<span class="number">5</span>);      <span class="comment">// jump to position 5</span></span><br><span class="line">travels.<span class="title function_">reset</span>();    <span class="comment">// back to initial</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// History info</span></span><br><span class="line">travels.<span class="title function_">getHistory</span>();</span><br><span class="line">travels.<span class="title function_">getPosition</span>();</span><br><span class="line">travels.<span class="title function_">canBack</span>();</span><br><span class="line">travels.<span class="title function_">canForward</span>();</span><br></pre></td></tr></table></figure>

<p>If you’ve used Immer or Mutative, there’s essentially no learning curve.</p>
<h2 id="Benchmarks"><a href="#Benchmarks" class="headerlink" title="Benchmarks"></a>Benchmarks</h2><p>To validate the analysis, I wrote comprehensive benchmarks. Setup:</p>
<ul>
<li><strong>Object size</strong>: ~100KB (nested objects&#x2F;arrays)</li>
<li><strong>Ops</strong>: 100 tiny edits (2 fields per op)</li>
<li><strong>Env</strong>: Node.js v22.21.1</li>
<li><strong>Memory</strong>: measured precisely with <code>--expose-gc</code></li>
</ul>
<p>Full code: <a href="https://github.com/mutativejs/travels/tree/main/benchmarks"><code>./benchmarks/</code></a></p>
<h3 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h3><p>The latest runs (Node v22.21.1) come from executing <code>yarn test:all</code>, which runs both benchmark scripts with <code>node --expose-gc</code>.</p>
<h4 id="Simulated-implementations-memory-performance-test-js"><a href="#Simulated-implementations-memory-performance-test-js" class="headerlink" title="Simulated implementations (memory-performance-test.js)"></a>Simulated implementations (<code>memory-performance-test.js</code>)</h4><table>
<thead>
<tr>
<th>Metric</th>
<th>Redux-undo</th>
<th>Zundo</th>
<th>Travels</th>
</tr>
</thead>
<tbody><tr>
<td>Memory (MB)</td>
<td>11.8</td>
<td>11.8</td>
<td><strong>0.32</strong></td>
</tr>
<tr>
<td>setState (ms)</td>
<td>42.74</td>
<td><strong>41.27</strong></td>
<td>88.16</td>
</tr>
<tr>
<td>Undo (ms)</td>
<td>0.08</td>
<td><strong>0.07</strong></td>
<td>18.65</td>
</tr>
<tr>
<td>Redo (ms)</td>
<td>0.12</td>
<td><strong>0.02</strong></td>
<td>20.34</td>
</tr>
<tr>
<td>Serialized size (KB)</td>
<td>11,626.66</td>
<td>11,626.46</td>
<td><strong>20.6</strong></td>
</tr>
<tr>
<td>Serialize (ms)</td>
<td>12.86</td>
<td>11.88</td>
<td><strong>0.06</strong></td>
</tr>
<tr>
<td>Deserialize (ms)</td>
<td>23.6</td>
<td>23.55</td>
<td><strong>0.14</strong></td>
</tr>
</tbody></table>
<ul>
<li>Travels keeps simulated history sizes tiny (20.6 KB vs ~11 MB snapshots) and serializes &gt;200× faster, while snapshot stores remain unbeatable for undo&#x2F;redo latency.</li>
<li>The Travels simulated <code>setState</code> cost (88 ms for 100 updates) is roughly 2× the snapshot stores, which matches expectations for generating JSON Patch.</li>
</ul>
<h4 id="Real-libraries-real-library-benchmark-js"><a href="#Real-libraries-real-library-benchmark-js" class="headerlink" title="Real libraries (real-library-benchmark.js)"></a>Real libraries (<code>real-library-benchmark.js</code>)</h4><table>
<thead>
<tr>
<th>Metric</th>
<th>Redux-undo</th>
<th>Zundo</th>
<th>Travels</th>
</tr>
</thead>
<tbody><tr>
<td>Memory (MB)</td>
<td>0.05</td>
<td><strong>0.04</strong></td>
<td>0.16</td>
</tr>
<tr>
<td>setState (ms)</td>
<td>0.35</td>
<td><strong>0.3</strong></td>
<td>1.81</td>
</tr>
<tr>
<td>Undo (ms)</td>
<td>0.25</td>
<td><strong>0.12</strong></td>
<td>0.69</td>
</tr>
<tr>
<td>Redo (ms)</td>
<td><strong>0.07</strong></td>
<td>0.15</td>
<td>0.27</td>
</tr>
<tr>
<td>Serialized size (KB)</td>
<td>11,742.03</td>
<td>11,510.59</td>
<td><strong>116.26</strong></td>
</tr>
<tr>
<td>Serialize (ms)</td>
<td>12.63</td>
<td>11.59</td>
<td><strong>0.61</strong></td>
</tr>
<tr>
<td>Deserialize (ms)</td>
<td>28.87</td>
<td>22.66</td>
<td><strong>0.42</strong></td>
</tr>
</tbody></table>
<ul>
<li>Even with real packages, Travels shrinks serialized history by roughly 100× and finishes (de)serialization well under a millisecond.</li>
<li>Snapshot-based stacks still win hot-path operations (setState&#x2F;undo&#x2F;redo), so workloads that prioritize raw speed over persistence will continue to prefer Redux-undo&#x2F;Zundo.</li>
</ul>
<h3 id="Performance-Conclusion"><a href="#Performance-Conclusion" class="headerlink" title="Performance Conclusion"></a>Performance Conclusion</h3><p><strong>Snapshot approaches (Redux-undo &#x2F; default Zundo):</strong></p>
<ul>
<li>✅ Fastest <code>setState</code></li>
<li>✅ Fastest undo&#x2F;redo</li>
<li>❌ Huge memory</li>
<li>❌ Large serialized payloads</li>
<li>❌ Poor fit for persistence</li>
</ul>
<p><strong>Travels (built-in JSON Patch):</strong></p>
<ul>
<li>⚠️ Slower <code>setState</code> (patch generation)</li>
<li>⚠️ Slower undo&#x2F;redo (patch application)</li>
<li>✅ Low memory</li>
<li>✅ Extremely small persistence ⭐</li>
<li>✅ Zero-config, out of the box</li>
<li>✅ Standard format, great for storage&#x2F;analytics</li>
</ul>
<p><strong>Recommendation:</strong></p>
<ul>
<li>Simple apps, unconcerned with memory → Redux-undo&#x2F;Zundo default</li>
<li>Need persistence, cross-framework, plug-and-play → <strong>Travels</strong></li>
</ul>
<h2 id="When-to-Use-It"><a href="#When-to-Use-It" class="headerlink" title="When to Use It"></a>When to Use It</h2><p>Travels isn’t a silver bullet; it shines when:</p>
<p><strong>✅ Good fit:</strong></p>
<ul>
<li>State objects are large (&gt;10KB)</li>
<li>You need cross-framework reuse</li>
<li>Memory-sensitive environments (mobile, embedded)</li>
<li>You want fine-grained history control (manual archive, custom windows)</li>
</ul>
<p><strong>❌ Less ideal:</strong></p>
<ul>
<li>Very simple state (a few fields—Redux-undo is simpler)</li>
<li>Deeply invested in Zustand (Zundo is lighter)</li>
<li>You don’t care about memory</li>
</ul>
<h2 id="Comparison-Summary"><a href="#Comparison-Summary" class="headerlink" title="Comparison Summary"></a>Comparison Summary</h2><p><strong>Redux-undo</strong> is a dependable standard in the Redux ecosystem but is Redux-bound.</p>
<p><strong>Zundo</strong> is elegantly designed and supports diff optimization, but pushes diff complexity onto users.</p>
<p><strong>Travels</strong> treats JSON Patch as a first-class citizen—out-of-the-box memory savings, framework-agnostic, and high-performance where it matters for persistence.</p>
<p>If you’re building:</p>
<ul>
<li>Rich text editors</li>
<li>Graphics&#x2F;design tools</li>
<li>Collaborative editing apps</li>
<li>Complex form systems</li>
</ul>
<p>—i.e., anything with frequent undo&#x2F;redo—Travels is worth a try.</p>
<h2 id="Technical-Details"><a href="#Technical-Details" class="headerlink" title="Technical Details"></a>Technical Details</h2><h3 id="JSON-Patch-Reversibility"><a href="#JSON-Patch-Reversibility" class="headerlink" title="JSON Patch Reversibility"></a>JSON Patch Reversibility</h3><p>Travels stores both <code>patches</code> and <code>inversePatches</code>:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Change: count: 0 -&gt; 1</span></span><br><span class="line"><span class="attr">patches</span>: [&#123; <span class="attr">op</span>: <span class="string">&#x27;replace&#x27;</span>, <span class="attr">path</span>: [<span class="string">&#x27;count&#x27;</span>], <span class="attr">value</span>: <span class="number">1</span> &#125;];</span><br><span class="line"><span class="attr">inversePatches</span>: [&#123; <span class="attr">op</span>: <span class="string">&#x27;replace&#x27;</span>, <span class="attr">path</span>: [<span class="string">&#x27;count&#x27;</span>], <span class="attr">value</span>: <span class="number">0</span> &#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Redo: apply patches</span></span><br><span class="line"><span class="comment">// Undo: apply inversePatches</span></span><br></pre></td></tr></table></figure>

<p>This guarantees reliable time travel.</p>
<h3 id="Why-Mutative-Is-Fast"><a href="#Why-Mutative-Is-Fast" class="headerlink" title="Why Mutative Is Fast"></a>Why Mutative Is Fast</h3><p>Mutative’s performance comes from:</p>
<ol>
<li><strong>Copy-on-write</strong> – only copy what changes</li>
<li><strong>Shallow copy</strong> – shallow by default; deep when needed</li>
<li><strong>Incremental patch generation</strong> – not a post-hoc diff</li>
</ol>
<p>This is typically faster than Immer and far more efficient than <code>JSON.parse(JSON.stringify())</code>.</p>
<h3 id="Why-JSON-Patch-Excels-at-Persistence"><a href="#Why-JSON-Patch-Excels-at-Persistence" class="headerlink" title="Why JSON Patch Excels at Persistence"></a>Why JSON Patch Excels at Persistence</h3><p>Another key advantage: <strong>JSON Patch is extremely well suited to persistence</strong>.</p>
<p>Suppose you want “save the entire edit history locally and resume it on next launch”:</p>
<p><strong>Redux-undo &#x2F; Zundo (full snapshots):</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Data to persist</span></span><br><span class="line"><span class="keyword">const</span> dataToSave = &#123;</span><br><span class="line">  <span class="attr">past</span>: [</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&quot;Doc&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;...&quot;</span>, <span class="attr">metadata</span>: &#123;...&#125; &#125;,        <span class="comment">// 100KB</span></span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">&quot;Doc v2&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;...&quot;</span>, <span class="attr">metadata</span>: &#123;...&#125; &#125;,     <span class="comment">// 100KB</span></span><br><span class="line">    <span class="comment">// ... 100 histories</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">present</span>: &#123; <span class="comment">/* current state */</span> &#125;,</span><br><span class="line">  <span class="attr">future</span>: []</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write to localStorage/IndexedDB</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;history&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(dataToSave));</span><br><span class="line"><span class="comment">// Problem: 10MB+ of serialized JSON</span></span><br></pre></td></tr></table></figure>

<p><strong>Travels (JSON Patch):</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Data to persist</span></span><br><span class="line"><span class="keyword">const</span> dataToSave = &#123;</span><br><span class="line">  <span class="attr">state</span>: travels.<span class="title function_">getState</span>(),        <span class="comment">// current state</span></span><br><span class="line">  <span class="attr">patches</span>: travels.<span class="title function_">getPatches</span>(),    <span class="comment">// only patches, just a few KB</span></span><br><span class="line">  <span class="attr">position</span>: travels.<span class="title function_">getPosition</span>(),  <span class="comment">// index</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;travels-state&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(dataToSave.<span class="property">state</span>));</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;travels-patches&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(dataToSave.<span class="property">patches</span>));</span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;travels-position&#x27;</span>, <span class="title class_">String</span>(dataToSave.<span class="property">position</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Restore</span></span><br><span class="line"><span class="keyword">const</span> travels = <span class="title function_">createTravels</span>(</span><br><span class="line">  <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;travels-state&#x27;</span>)),</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">initialPatches</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;travels-patches&#x27;</span>)),</span><br><span class="line">    <span class="attr">initialPosition</span>: <span class="title class_">Number</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;travels-position&#x27;</span>)),</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>Practical comparison (100 histories, from the benchmark):</strong></p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Redux-undo</th>
<th>Zundo</th>
<th>Travels</th>
</tr>
</thead>
<tbody><tr>
<td>localStorage usage</td>
<td>~11.7 MB</td>
<td>~11.5 MB</td>
<td>~116 KB</td>
</tr>
<tr>
<td><code>JSON.stringify</code> time</td>
<td>~12.6 ms</td>
<td>~11.6 ms</td>
<td>~0.61 ms (<strong>×20 faster</strong>) ⭐</td>
</tr>
<tr>
<td><code>JSON.parse</code> time</td>
<td>~28.9 ms</td>
<td>~22.7 ms</td>
<td>~0.42 ms (<strong>×55 faster</strong>) ⭐</td>
</tr>
<tr>
<td>Storage savings</td>
<td>–</td>
<td>–</td>
<td><strong>99%</strong> ⭐</td>
</tr>
<tr>
<td>IndexedDB write speed</td>
<td>Slow</td>
<td>Slow</td>
<td>Fast (100×+ less data)</td>
</tr>
</tbody></table>
<p>Why such a gap?</p>
<ol>
<li><strong>Size</strong>: Patches are inherently compact</li>
<li><strong>(De)serialization</strong>: tiny payloads make JSON faster</li>
<li><strong>Quotas</strong>: localStorage caps at 5–10MB; Travels stores far more history</li>
</ol>
<h3 id="Real-World-Patterns"><a href="#Real-World-Patterns" class="headerlink" title="Real-World Patterns"></a>Real-World Patterns</h3><p>This matters in many cases:</p>
<p><strong>1) Offline-first apps</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Save to local storage on every change</span></span><br><span class="line">travels.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Always-on autosave is feasible because data is tiny</span></span><br><span class="line">  <span class="title function_">saveToLocalStorage</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: travels.<span class="title function_">getState</span>(),</span><br><span class="line">    <span class="attr">patches</span>: travels.<span class="title function_">getPatches</span>(),</span><br><span class="line">    <span class="attr">position</span>: travels.<span class="title function_">getPosition</span>(),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next launch resumes with full undo/redo history</span></span><br></pre></td></tr></table></figure>

<p><strong>2) Collaborative editing operation logs</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sync patches to server</span></span><br><span class="line">travels.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">state, patches, position</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// patches are standard JSON Patch (RFC 6902)</span></span><br><span class="line">  <span class="comment">// Send for:</span></span><br><span class="line">  <span class="comment">// - Operational history</span></span><br><span class="line">  <span class="comment">// - Conflict resolution</span></span><br><span class="line">  <span class="comment">// - Playback/replay</span></span><br><span class="line">  api.<span class="title function_">syncPatches</span>(patches);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>3) Versioning &amp; audit</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JSON Patch doubles as an operation log</span></span><br><span class="line"><span class="keyword">const</span> auditLog = travels.<span class="title function_">getPatches</span>().<span class="property">patches</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">patch, index</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">  <span class="attr">user</span>: currentUser,</span><br><span class="line">  <span class="attr">changes</span>: patch, <span class="comment">// standard, easy to review</span></span><br><span class="line">  <span class="attr">position</span>: index,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Can export to human-friendly formats:</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">2024-01-01 10:00:00 - User A:</span></span><br><span class="line"><span class="comment">  - Changed /title from &quot;Draft&quot; to &quot;Final&quot;</span></span><br><span class="line"><span class="comment">  - Added /tags/0 = &quot;published&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2024-01-01 10:05:00 - User B:</span></span><br><span class="line"><span class="comment">  - Replaced /content/paragraphs/3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>4) Product analytics</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Analyze editing patterns</span></span><br><span class="line"><span class="keyword">const</span> stats = <span class="title function_">analyzePatches</span>(travels.<span class="title function_">getPatches</span>());</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  totalOperations: 150,</span></span><br><span class="line"><span class="comment">  avgPatchSize: 45,  // bytes</span></span><br><span class="line"><span class="comment">  mostEditedFields: [&quot;/title&quot;, &quot;/content/section[0]&quot;],</span></span><br><span class="line"><span class="comment">  undoRate: 0.15</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>Here, JSON Patch’s standardized, compact format is a huge win. Snapshot-based Redux-undo&#x2F;Zundo are simple, but become unwieldy once persistence enters the picture.</p>
<h2 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h2><ul>
<li><strong>Travels</strong>: <a href="https://github.com/mutativejs/travels">https://github.com/mutativejs/travels</a></li>
<li><strong>use-travel</strong>: <a href="https://github.com/mutativejs/use-travel">https://github.com/mutativejs/use-travel</a> (React hook)</li>
<li><strong>zustand-travel</strong>: <a href="https://github.com/mutativejs/zustand-travel">https://github.com/mutativejs/zustand-travel</a> (Zustand middleware)</li>
<li><strong>Mutative</strong>: <a href="https://github.com/unadlib/mutative">https://github.com/unadlib/mutative</a></li>
</ul>
<h2 id="Final-Thoughts"><a href="#Final-Thoughts" class="headerlink" title="Final Thoughts"></a>Final Thoughts</h2><p>Before writing this post, I read the source code of all three libraries carefully. Redux-undo and Zundo are both excellent and have their places.</p>
<p>Travels isn’t a silver bullet; it targets a specific problem: <strong>when you need long histories, how do you minimize memory usage, reduce performance overhead, and stay as general and feature-complete as possible?</strong> Its philosophy is to trade compute for memory, which pays off the most when state is large, changes are small, and histories are long. No need to pick a diff library, write conversion logic, or wrangle edge cases—those are built in.</p>
<p>If you’re implementing or optimizing undo&#x2F;redo—especially for collaborative editors, visual design tools, game editors, or any app that needs long operation histories and hits memory&#x2F;perf ceilings—Travels is worth a try. It may not be the only answer, but it’s certainly one to consider.</p>
<blockquote>
<p>This article is based on source reviews of redux-undo v1.1.0, zundo v2.3.0, and travels v0.9.0. If anything is inaccurate, corrections are welcome.</p>
</blockquote>

  </div>
</article>

  </div>
</div>


  <!-- scripts list from theme config.yml -->
  
    <script src="/js/attraction.js"></script>
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/codemirror.min.js"></script>
  
  <script>
    var nodes = Array.from(document.querySelectorAll('pre code'));
    var render = {};
    var titleSvg = '<svg style="position: absolute;z-index: 1;margin: 12px 0 0 12px;" xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg>';
    nodes.forEach((node, index) => {
      var lang = node.getAttribute('class');
      var code = node.innerText;
      var mode = lang;
      switch(lang) {
        case 'jsx':
          lang = 'javascript';
          mode = 'text/jsx';
          break;
        case 'tsx':
          lang = 'javascript';
          mode = 'text/typescript-jsx';
        case 'typescript':
          lang = 'javascript';
          mode = 'text/typescript';
        default:
          break;
      }
      var config = {
        value: code,
        mode,
        theme: 'seti'
      };
      if (!lang) return;
      var hasExisted = nodes.slice(0, index).find(function(node) { return node.getAttribute('class') === lang; });
      if (hasExisted) {
        render[lang].push(function() {
          node.innerHTML = titleSvg;
          CodeMirror(node, config);
        });
        return;
      }
      render[lang] = [];
      var languagePackge = document.createElement('script');
      languagePackge.src = `https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.46.0/mode/${lang}/${lang}.min.js`;
      languagePackge.onload = () => {
        setTimeout(() => {
          node.innerHTML = titleSvg;
          CodeMirror(node, config);
          render[lang].forEach(function(callback) { callback(); })
        }, 0);
      }
      document.body.appendChild(languagePackge);
    });
  </script>

</body>
</html>
